<?xml version="1.0" encoding="UTF-8"?>
<coderabbit_instructions generated="2025-01-17T10:30:00Z">
  <!-- Agent Context: Establishes clear role and capabilities -->
  <agent_context>
    <persona language="english">
      # Senior Software Development Consultant

      You are an experienced software developer. Analyze CodeRabbit review issues and suggest appropriate code fixes.
      Your response should be composed of thoughtful, comprehensive analysis in <analysis_sections> tags.
    </persona>

    <thinking_guidance>Leverage interleaved thinking - reflect after each analysis step</thinking_guidance>

    <capabilities>Code analysis, issue prioritization, solution generation</capabilities>
  </agent_context>

  <!-- Task Definition: Explicit instructions with motivational context -->
  <task_overview>
    <objective>Transform CodeRabbit feedback into actionable development improvements</objective>
    <motivation>Enhance code quality, security, and maintainability through systematic review implementation</motivation>
    <execution_approach>Address systematically by priority, invoke relevant tools simultaneously</execution_approach>

    <statistics>
      <total_comments>26</total_comments>
      <actionable_comments>7</actionable_comments>
      <nitpick_comments>18</nitpick_comments>
      <outside_diff_comments>1</outside_diff_comments>
    </statistics>
  </task_overview>

  <!-- Execution Framework: Structured for parallel processing -->
  <execution_instructions>
    <instruction_philosophy>Focus on positive, constructive improvements rather than problem identification alone.</instruction_philosophy>

    <primary_tasks parallel_processing="recommended">
      <!-- Actionable Comments: Extract from "Actionable comments posted: 7" section -->
      <task comment_id="actionable_0" category="actionable">
        <description>Fix long exception messages by moving them to custom exception classes</description>
        <file>lazygit-llm/lazygit_llm/api_providers/__init__.py</file>
        <line>30</line>
        <ai_agent_prompt>
          Avoid specifying long messages outside the exception class (TRY003). Create custom exception classes
          to replace long exception messages in the provider registration system.
        </ai_agent_prompt>
      </task>

      <!-- Nitpick Comments: Extract from "🧹 Nitpick comments (18)" section -->
      <task comment_id="nitpick_0" category="nitpick">
        <description>Task 1のまとめは明確。Task 4と内容が重複している点だけ整理を。</description>
        <file>.specs/tasks.md</file>
        <line>3-8</line>
        <ai_agent_prompt>
          Task 4に「BaseProvider作成」が再掲されています。Task 4は「ProviderFactory実装と拡張ポイント整備」（登録/インスタンス化/接続テストIFなど）に絞ると、進捗トラッキングがより正確になります。
        </ai_agent_prompt>
      </task>

      <!-- Outside Diff Range Comments: Extract from "⚠️ Outside diff range comments (1)" section -->
      <task comment_id="outside_diff_0" category="outside_diff">
        <description>重複を排除してラッパー化(推奨全置換パッチ)</description>
        <file>lazygit-llm/src/main.py</file>
        <line>1-209</line>
        <ai_agent_prompt>
          重複を排除してラッパー化。最小ラッパーに置き換え、ドキュメントのパイプ例も削除。
          sys.path 直接操作と src.* 依存を撤去し、単一エントリに集約してください。
        </ai_agent_prompt>
      </task>
    </primary_tasks>

    <implementation_guidance>
      <systematic_approach>Address issues systematically, test each change incrementally</systematic_approach>
      <solution_requirements>Focus on robust, general solutions for all valid inputs</solution_requirements>
    </implementation_guidance>
  </execution_instructions>

  <!-- Rich Context: Supporting detailed reasoning -->
  <context_data>
    <summary_information>
      <summary>
        <content>
          ## Summary by CodeRabbit

          - 新機能
            - LazyGit向け LLM コミットメッセージ生成CLIを追加（lazygit-llm-generate）。設定読み込み、接続テスト、詳細ログ、バージョン表示に対応。
            - OpenAI／Anthropic／Geminiを選択可能なプロバイダー拡張基盤を実装。
          - ドキュメント
            - 設定例 config.yml.example を追加（プロンプトテンプレート、タイムアウト／トークン、追加パラメータを記載）。
            - タスク仕様を最新状態に更新。
          - チョア
            - 配布用のセットアップと依存関係（requirements）を追加。
            - .gitignore を拡充。
        </content>
        <walkthrough>
          新規パッケージ「lazygit-llm」を追加し、CLIエントリポイント、抽象プロバイダ基底クラス、API/CLIプロバイダ用レジストリ、設定例、パッケージング関連（setup.py／requirements.txt／.gitignore）、メタデータ、及び仕様タスク更新を導入。メイン実行フロー（設定→差分取得→プロバイダ→メッセージ整形→出力）と設定テスト機能を実装。
        </walkthrough>
      </summary>
    </summary_information>

    <thread_contexts>
      <thread id="{thread_id}" resolved="{true|false}">
        <file_context>{target_file_path}</file_context>
        <line_context>{target_line_range}</line_context>
        <inline_comments>
          <comment id="{comment_id}">
            <author>coderabbitai[bot]</author>
            <content>{original_coderabbit_comment_content}</content>
            <timestamp>{iso8601_timestamp}</timestamp>
          </comment>
        </inline_comments>
        <structured_data>
          {
            "thread_id": "{thread_identifier}",
            "participants": ["coderabbitai[bot]"],
            "context_summary": "{thread_context_summary}",
            "resolution_status": "{resolved|unresolved}",
            "last_activity": "{iso8601_timestamp}"
          }
        </structured_data>
      </thread>
    </thread_contexts>

    <coderabbit_analysis>
      <actionable_comments_count>7</actionable_comments_count>
      <nitpick_comments_count>18</nitpick_comments_count>
      <outside_diff_comments_count>1</outside_diff_comments_count>

      <comment_categories>
        <actionable>Critical fixes requiring immediate attention</actionable>
        <nitpick>Code quality improvements and best practices</nitpick>
        <outside_diff>Infrastructure and dependency issues</outside_diff>
      </comment_categories>
    </coderabbit_analysis>
  </context_data>
</coderabbit_instructions>
