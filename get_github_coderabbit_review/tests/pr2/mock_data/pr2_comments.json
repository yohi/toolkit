[
  {
    "url": "https://api.github.com/repos/yohi/lazygit-llm-commit-generator/pulls/comments/2354255369",
    "pull_request_review_id": 3232599712,
    "id": 2354255369,
    "node_id": "PRRC_kwDOPxR4rs6MUxYJ",
    "diff_hunk": "@@ -0,0 +1,142 @@\n+\"\"\"\n+ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹\n+\n+å…¨ã¦ã®LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãŒå®Ÿè£…ã™ã¹ãå…±é€šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã€‚\n+APIå‹ã¨CLIå‹ã®ä¸¡æ–¹ã«å¯¾å¿œã™ã‚‹æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹ã€‚\n+\"\"\"\n+\n+from abc import ABC, abstractmethod\n+from typing import Dict, Any, Optional\n+import logging\n+\n+logger = logging.getLogger(__name__)\n+\n+\n+class BaseProvider(ABC):\n+    \"\"\"å…¨LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®åŸºåº•ã‚¯ãƒ©ã‚¹\"\"\"\n+\n+    def __init__(self, config: Dict[str, Any]):\n+        \"\"\"\n+        ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–\n+\n+        Args:\n+            config: ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ã®è¨­å®šæƒ…å ±\n+        \"\"\"\n+        self.config = config\n+        self.timeout = config.get('timeout', 30)\n+        self.max_tokens = config.get('max_tokens', 100)\n+\n+    @abstractmethod\n+    def generate_commit_message(self, diff: str, prompt_template: str) -> str:\n+        \"\"\"\n+        Gitã®å·®åˆ†ã‹ã‚‰ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ\n+\n+        Args:\n+            diff: `git diff --staged`ã®å‡ºåŠ›\n+            prompt_template: LLMã«é€ä¿¡ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ\n+\n+        Returns:\n+            ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n+\n+        Raises:\n+            ProviderError: ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼\n+            TimeoutError: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼\n+            AuthenticationError: èªè¨¼ã‚¨ãƒ©ãƒ¼\n+        \"\"\"\n+        pass\n+\n+    @abstractmethod\n+    def test_connection(self) -> bool:\n+        \"\"\"\n+        ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¸ã®æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ\n+\n+        Returns:\n+            æ¥ç¶šãŒæˆåŠŸã—ãŸå ´åˆTrueã€å¤±æ•—ã—ãŸå ´åˆFalse\n+        \"\"\"\n+        pass\n+\n+    def supports_streaming(self) -> bool:\n+        \"\"\"\n+        ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡ºåŠ›ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‹ã©ã†ã‹\n+\n+        Returns:\n+            ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹å ´åˆTrue\n+        \"\"\"\n+        return False\n+\n+    def validate_config(self) -> bool:\n+        \"\"\"\n+        è¨­å®šæƒ…å ±ã‚’æ¤œè¨¼\n+\n+        Returns:\n+            è¨­å®šãŒæœ‰åŠ¹ãªå ´åˆTrueã€ç„¡åŠ¹ãªå ´åˆFalse\n+        \"\"\"\n+        required_fields = self.get_required_config_fields()\n+        for field in required_fields:\n+            if field not in self.config:\n+                logger.error(f\"å¿…é ˆè¨­å®šé …ç›®ãŒä¸è¶³: {field}\")\n+                return False\n+        return True\n+\n+    @abstractmethod\n+    def get_required_config_fields(self) -> list[str]:\n+        \"\"\"\n+        ã“ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å¿…è¦ãªè¨­å®šé …ç›®ã®ãƒªã‚¹ãƒˆã‚’è¿”ã™\n+\n+        Returns:\n+            å¿…é ˆè¨­å®šé …ç›®ã®ãƒªã‚¹ãƒˆ\n+        \"\"\"\n+        pass\n+\n+    def _format_prompt(self, diff: str, prompt_template: str) -> str:\n+        \"\"\"\n+        ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å·®åˆ†ã‚’æŒ¿å…¥ã—ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ\n+\n+        Args:\n+            diff: Gitå·®åˆ†\n+            prompt_template: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ{diff}ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å«ã‚€ï¼‰\n+\n+        Returns:\n+            ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\n+        \"\"\"\n+        return prompt_template.format(diff=diff)\n+",
    "path": "lazygit-llm/src/base_provider.py",
    "commit_id": "80d4fb861ac992c037c44bbf19501c3f6a95aed5",
    "original_commit_id": "d4c4369ba25d6d330c18e567569e18b05664751d",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_\n\n**é‡å¤§: `str.format`ã¯diffå†…ã®`{}`ã§å£Šã‚Œã¾ã™ã€‚`Template.safe_substitute`ã¸ç½®æ›ã‚’ã€‚**\n\nJSON/ãƒ†ãƒ³ãƒ—ãƒ¬å…¥ã‚Šã®diffã«`{`/`}`ãŒã‚ã‚‹ã¨KeyErrorã§è½ã¡ã¾ã™ã€‚`string.Template`ï¼‹`$diff`ã«ç§»è¡Œã—ã€å¾Œæ–¹äº’æ›ã¨ã—ã¦`{diff}`â†’`$diff`ã®ç½®æ›ã‚‚å…¥ã‚Œã¦ãã ã•ã„ã€‚\n\n```diff\n-from typing import Dict, Any, Optional\n+from typing import Dict, Any, Optional\n+from string import Template\n@@\n-    def _format_prompt(self, diff: str, prompt_template: str) -> str:\n+    def _format_prompt(self, diff: str, prompt_template: str) -> str:\n@@\n-        return prompt_template.format(diff=diff)\n+        # å¾Œæ–¹äº’æ›: æ—§ `{diff}` ã‚’ `$diff` ã«æ­£è¦åŒ–\n+        if \"{diff}\" in prompt_template:\n+            prompt_template = prompt_template.replace(\"{diff}\", \"$diff\")\n+        tmpl = Template(prompt_template)\n+        return tmpl.safe_substitute(diff=diff)\n```\nä½µã›ã¦è¨­å®šä¾‹ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ã‚‚`$diff`ã«æ›´æ–°ã—ã¦ãã ã•ã„ã€‚\n\n<!-- suggestion_start -->\n\n<details>\n<summary>ğŸ“ Committable suggestion</summary>\n\n> â€¼ï¸ **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\ndef _format_prompt(self, diff: str, prompt_template: str) -> str:\n    \"\"\"\n    ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å·®åˆ†ã‚’æŒ¿å…¥ã—ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ\n\n    Args:\n        diff: Gitå·®åˆ†\n        prompt_template: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ{diff}ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å«ã‚€ï¼‰\n\n    Returns:\n        ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\n    \"\"\"\n    # å¾Œæ–¹äº’æ›: æ—§ `{diff}` ã‚’ `$diff` ã«æ­£è¦åŒ–\n    if \"{diff}\" in prompt_template:\n        prompt_template = prompt_template.replace(\"{diff}\", \"$diff\")\n    tmpl = Template(prompt_template)\n    return tmpl.safe_substitute(diff=diff)\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>ğŸ§° Tools</summary>\n\n<details>\n<summary>ğŸª› Ruff (0.12.2)</summary>\n\n97-97: Docstring contains ambiguous `ï¼ˆ` (FULLWIDTH LEFT PARENTHESIS). Did you mean `(` (LEFT PARENTHESIS)?\n\n(RUF002)\n\n---\n\n97-97: Docstring contains ambiguous `ï¼‰` (FULLWIDTH RIGHT PARENTHESIS). Did you mean `)` (RIGHT PARENTHESIS)?\n\n(RUF002)\n\n</details>\n\n</details>\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nIn lazygit-llm/src/base_provider.py around lines 91 to 103, _format_prompt\ncurrently uses str.format which breaks on raw `{}` in diffs; change it to use\nstring.Template.safe_substitute with a `$diff` placeholder: update the method to\naccept the prompt_template, detect and replace any legacy `{diff}` occurrences\nwith `$diff` before creating a string.Template, then call\nsafe_substitute({'diff': diff}) to produce the formatted prompt; also update any\nconfiguration/examples that use `{diff}` to use `$diff` instead to keep examples\nconsistent.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\nâœ… Addressed in commit 61a0f7a",
    "created_at": "2025-09-17T04:17:40Z",
    "updated_at": "2025-09-17T15:12:28Z",
    "html_url": "https://github.com/yohi/lazygit-llm-commit-generator/pull/2#discussion_r2354255369",
    "pull_request_url": "https://api.github.com/repos/yohi/lazygit-llm-commit-generator/pulls/2",
    "author_association": "NONE",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/yohi/lazygit-llm-commit-generator/pulls/comments/2354255369"
      },
      "html": {
        "href": "https://github.com/yohi/lazygit-llm-commit-generator/pull/2#discussion_r2354255369"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/yohi/lazygit-llm-commit-generator/pulls/2"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/yohi/lazygit-llm-commit-generator/pulls/comments/2354255369/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 91,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 103,
    "side": "RIGHT",
    "original_position": 103,
    "position": 1,
    "subject_type": "line"
  }
]
