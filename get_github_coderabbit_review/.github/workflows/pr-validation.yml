name: PR Validation - Essential Tests

on:
  pull_request:
    branches: [ main, master, develop ]
    paths:
      - 'get_github_coderabbit_review/**'
  push:
    branches: [ main, master, develop ]
    paths:
      - 'get_github_coderabbit_review/**'

jobs:
  essential-tests:
    name: Essential Tests (PR2 & PR38)
    runs-on: ubuntu-latest
    
    defaults:
      run:
        working-directory: get_github_coderabbit_review
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # åŸºæœ¬çš„ãªä¾å­˜é–¢ä¿‚ã®ã¿ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œã«å¿…è¦ãªæœ€å°é™ï¼‰
        pip install pytest unittest-xml-reporting
        
    - name: Verify test structure
      run: |
        echo "ðŸ“ Project structure verification"
        ls -la
        echo "ðŸ“ Tests directory structure"
        ls -la tests/
        echo "ðŸ“ PR2 test files"
        ls -la tests/pr2/
        echo "ðŸ“ PR38 test files"  
        ls -la tests/pr38/
        
    - name: Run Essential Tests
      run: |
        cd tests
        echo "ðŸš€ Starting Essential Tests (GitHub Actions)"
        echo "   Running PR2 and PR38 mock-based output validation tests"
        python run_essential_tests.py
        
    - name: Upload test results
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: test-results
        path: |
          get_github_coderabbit_review/tests/*.log
          get_github_coderabbit_review/tests/**/test_*.log
        retention-days: 5
        
    - name: Test summary
      if: always()
      run: |
        echo "## ðŸ“Š Essential Tests Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Tests Executed:" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… PR38ãƒ¢ãƒƒã‚¯åŒ–ãƒ†ã‚¹ãƒˆï¼ˆæœŸå¾…å€¤ã¨ã®æ¯”è¼ƒï¼‰" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… PR2ãƒ¢ãƒƒã‚¯åŒ–ãƒ†ã‚¹ãƒˆï¼ˆå‡ºåŠ›ç”Ÿæˆç¢ºèªï¼‰" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Features:" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸš« GitHubèªè¨¼ä¸è¦" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ”„ ãƒ¢ãƒƒã‚¯åŒ–ã•ã‚ŒãŸGitHub APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ä½¿ç”¨" >> $GITHUB_STEP_SUMMARY
        echo "- âš¡ é«˜é€Ÿå®Ÿè¡Œï¼ˆessentialãƒ†ã‚¹ãƒˆã®ã¿ï¼‰" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "All tests completed successfully! ðŸŽ‰" >> $GITHUB_STEP_SUMMARY